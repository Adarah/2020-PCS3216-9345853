<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Trabalho final de Sistemas de Programação</title>
<meta name="author" content="Lucas Yuji Harada"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="https://revealjs.com/css/reveal.css"/>

<link rel="stylesheet" href="https://revealjs.com/css/theme/black.css" id="theme"/>

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'https://revealjs.com/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide">
<h1 class="title">Trabalho final de Sistemas de Programação</h1><h2 class="author">Lucas Yuji Harada</h2><p class="date">Created: 2020-05-11 seg 11:22</p>
</section>
<section id="table-of-contents-section">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#/slide-1">1. Objetivo</a></li>
<li><a href="#/slide-2">2. Desenvolvimento</a>
<ul>
<li><a href="#/slide-2-1">2.1. CPU</a></li>
<li><a href="#/slide-2-2">2.2. Loader</a></li>
<li><a href="#/slide-2-3">2.3. Assembler</a></li>
</ul>
</li>
<li><a href="#/slide-3">3. Uso</a>
<ul>
<li><a href="#/slide-3-1">3.1. Instalação</a>
<ul>
<li><a href="#/slide-3-1-1">3.1.1. <span class="todo TODO">TODO</span> Double check the instalation procedure, maybe add a windows step-by-step as well? or pyinstaller</a></li>
</ul>
</li>
<li><a href="#/slide-3-2">3.2. Testes</a></li>
<li><a href="#/slide-3-3">3.3. Uso normal</a></li>
</ul>
</li>
</ul>
</div>
</div>
</section>

<section>
<section id="slide-1">
<h2 id="1"><span class="section-number-2">1</span> Objetivo</h2>
<p>
Para a primeira etapa do projeto, o objetivo é desenvolver três peças essencials a qualquer computador:
</p>
<ul>
<li>Loader</li>
<li>CPU (Von Neumann Machine)</li>
<li>Assembler</li>

</ul>
</section>
</section>
<section>
<section id="slide-2">
<h2 id="2"><span class="section-number-2">2</span> Desenvolvimento</h2>
<div class="outline-text-2" id="text-2">
</div>
</section>
<section id="slide-2-1">
<h3 id="2-1"><span class="section-number-3">2.1</span> CPU</h3>
<p>
Baseado em princípios de test-driven-development (TDD), eu decidi primeiro criar
os testes de cada função a ser executada pela CPU (fetch, decode, add, load,
etc). Como o enunciado não especificava, fiz algumas considerações sobre o tamanho de cada um dos components:
</p>
<ul>
<li>memória: 12 bits (4096 endereços)</li>
<li>contador de instruções (PC): 12 bits</li>
<li>acumulador: 8 bits</li>

</ul>
<p>
O motivo para a escolha da memória com 12 bits é devido ao tamanho do operando. A única operação de OS call implementada até o momento é a de argumento 0, que realiza a saída do programa.
</p>
</section>
<section id="slide-2-2">
<h3 id="2-2"><span class="section-number-3">2.2</span> Loader</h3>
<p>
O loader foi escrito em assembly, e possui 59 bytes. GOAL_ONE e GOAL_TWO são as variáveis que guardam o MSB e LSB do endereço do programa a ser carregado. Ao final do procedimento de load, o loader automaticamente move o Program Counter para o endereço inicial do programa carregado.
</p>
<pre  class="example">
@   0
START
            GD  0
            MM GOAL_ONE
            +   NINETY
            MM  FIRST_BYTE
            GD  0
            MM GOAL_TWO
            MM  SECOND_BYTE
            GD  0
            MM  LENGTH
REPEAT
            GD  0
            JP  FIRST_BYTE
RETURN
            LD  SECOND_BYTE
            +   ONE
            MM  SECOND_BYTE
            JZ  CARRY
CHECK_IF_DONE
            LD  LENGTH
            -   ONE
            MM  LENGTH
            JZ  FINISH
            JP  REPEAT
CARRY
            LD  FIRST_BYTE
            +   ONE
            MM  FIRST_BYTE
            +   ONE
            JP  CHECK_IF_DONE

FIRST_BYTE   K  00 ;test
SECOND_BYTE  K  00
            JP RETURN
LENGTH       K  00
ONE          K  01
NINETY       K  /90
FINISH
GOAL_ONE     K 0
GOAL_TWO     K 0
#  START
</pre>
</section>
<section id="slide-2-3">
<h3 id="2-3"><span class="section-number-3">2.3</span> Assembler</h3>
<p>
Assemblers são programas que convertem mnemônicos assembly (ASM) para código de
máquina. Podem ser de um ou dois passos. Assemblers de dois passos primeiro
precisam gerar uma tabela de símbolos para depois conseguir traduzir à código de
máquina, enquanto que assembler de um passo fazem o processo de coletar
referências ainda não resolvidas, símbolos, e a montagem tudo ao mesmo tempo.
</p>

<p>
Nesse projeto eu decidi criar um assembler de dois passos por simplicidade. Para
a primeira entrega, o assembler não trata de casos em que existem mais de uma
psudo instrução de start (@). Outra restrição é que, quando usar símbolos (como
START/CARRY no exemplo do loader), é necessário que elas estejam em linhas
separadas de comandos.
</p>

</section>
</section>
<section>
<section id="slide-3">
<h2 id="3"><span class="section-number-2">3</span> Uso</h2>
<p>
Requisitos mínimos:
</p>
<ul>
<li>python 3.8+</li>
<li>Linux</li>

</ul>
<p>
Opcional:
</p>
<ul>
<li>git</li>

</ul>
</section>
<section id="slide-3-1">
<h3 id="3-1"><span class="section-number-3">3.1</span> Instalação</h3>
<div class="outline-text-3" id="text-3-1">
</div>
</section>
<section id="slide-3-1-1">
<h4 id="3-1-1"><span class="section-number-4">3.1.1</span> <span class="todo TODO">TODO</span> Double check the instalation procedure, maybe add a windows step-by-step as well? or pyinstaller</h4>
<ol>
<li><p>
Dentro de um terminal emulator, usar o comando:
</p>

<p>
<code>git clone https://github.com/Adarah/2020-PCS3216-9345853.git --shallow</code>
</p>
<ul>
<li>Caso não tenha o git instalado, pode baixar o código fonte manualmente do site da disciplina:
<a href="https://sites.google.com/view/2020-pcs3216-9345853">https://sites.google.com/view/2020-pcs3216-9345853</a></li>

</ul></li>
<li>Entrar na pasta que foi baixada: <code>cd 2020-PCS3216-9345853</code></li>
<li>Executar <code>pip install .</code></li>

</ol>
</section>
<section id="slide-3-2">
<h3 id="3-2"><span class="section-number-3">3.2</span> Testes</h3>
<p>
Usando a biblioteca pytest e hypothesis, cada um das minhas funções recebem ao
menos 200 inputs aleatórios, o que ajuda a garantir que o código funciona como
esperado. Para iniciar uma sessão de testes, basta executar o comando <code>pytest</code>
na raiz do diretório onde o código foi baixado.
</p>

<p>
Um programa exemplo que calcula os 12 primeiros dígitos da sequência fibonnaci
foi adicionado como teste para verficar o funcionamento do assembler.
</p>
</section>
<section id="slide-3-3">
<h3 id="3-3"><span class="section-number-3">3.3</span> Uso normal</h3>
<p>
O script <code>src/assembler.py</code> aceita um argumento opcional com a flag <code>-f</code>, que é
o caminho até o arquivo que se deseja montar. Caso nenhum argumento seja
fornecido, ele monta o arquivo <code>src/data/fibonacci.asm</code> por default. Para
realizar a montagem, use o comando seguindo esse padrão:
</p>

<p>
<code>python3 src/assembler.py -f my_custom_assembly.asm</code>
</p>

<p>
O novo binário será salvo em <code>src/data/program.bin</code>. Em máquinas Linux, caso deseje verificar o conteúdo
binário gerado pelo montador, use o comando <code>hexdump -C src/data/program.bin</code>
</p>

<p>
Com o programa já montado, agora rode o script <code>python3 src/cpu.py</code>, e a
execução irá iniciar automaticamente. Os outputs do programa serão guardados no
arquivo <code>src/data/output.txt</code>
</p>
</section>
</section>
</div>
</div>
<script src="https://revealjs.com/lib/js/head.min.js"></script>
<script src="https://revealjs.com/js/reveal.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: false,
fragmentInURL: false,
hashOneBasedIndex: false,
pdfSeparateFragments: true,

overview: true,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'convex', // see README of reveal.js for options
transitionSpeed: 'default',

// Optional libraries used to extend reveal.js
dependencies: [
 { src: 'https://revealjs.com/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://revealjs.com/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://revealjs.com/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: 'https://revealjs.com/plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: 'https://revealjs.com/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } }]

});
</script>
</body>
</html>
